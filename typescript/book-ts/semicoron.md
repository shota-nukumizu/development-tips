# TypeScriptでセミコロンをつけるべきかどうか

コーディングルールに関することはよく不毛な議論を招きやすい。

しかし、JavaScriptには自動セミコロン挿入という機能があるので、行末でセミコロンを省略しても多くの場合は文法的に問題ない。しかし、Bootstrapに含まれるJavaScriptプログラムを見ると、基本的にはセミコロンが使われていない。

# 自動セミコロン挿入とは

ECMAScriptの仕様に詳細に記述されているが、要約すると以下のようになる。

* 次の条件を満たす時、プログラムが文法的に許可されないトークンを含むならば、セミコロンが挿入される。(a)当該トークンの前に改行がある、または、(b)当該トークンが閉じカッコである。
* ファイル末尾に到達したとき、セミコロンを挿入しなければプログラムを解釈できないならば、セミコロンが挿入される。
* Restricted Productionが出現した時に、文法限定で`"[no Line Terminator here]"`と記述されている場所に改行があるならば、セミコロンが挿入される。

以下のような`.js`ファイルがあるなら、

```js
1
2
3
```

このようになる。

```js
1;
2;
3;
```

# Restriction Productionとは

JavaScriptでは、基本的にトークンは改行、スペースやタブなどの最低1個の空白文字で区切られ、空白文字の数や種類を増やしたり減らしたりしても文の意味は変わらない。これは、CやJavaなどのいわゆるC言語系と言われるようなプログラミング言語に共通する特徴だ。

しかし、JavaScriptには一部例外がある。`return`、`throw`、`break`、`continue`、`++`や`--`などのようなトークンの直後または直前の区切りの空白に限って、その中に改行が含まれる場合とそうではない場合で文の意味が変わるのだ。これら6種類の要素がRestriction Productionと言われている。改行が入ると自動的にセミコロンが挿入されるのだ。

```js
return
a + b
```

上記のコードが、

```js
return;
a + b;
```

このようになる。

しかし、このセミコロン自動生成機能には致命的な欠陥がある。それは、`return`直後の改行で意図しない動作をすることだ。あと、**セミコロンを省略することで`()`が意図せず関数呼び出しとして解釈される**という問題が生じることがある。

# セミコロンに関係する論争

前述の通り、Bootstrapは末尾にセミコロンを書かないスタイルを取っている。Bootstrapの公式クリエイターの一人はこの理由についてブログで以下のように説明している。

* JavaScriptがそもそも多様な書き方を許す言語である
* セミコロン自動生成に頼れば、ステートメント末尾は`\n`のみで十分
* 改行後の`(function() {...})()`と結合して関数呼び出しと認識される件については、代わりに`!function() { ... }()`と書けば回避できる

より具体的に言えば、

```js
a = b + c

!function() {
    var x, y, z;
}()
```

このように書けば`c`と`()`がつながることなく、その場で関数を呼び出せる。

# セミコロンの弊害

## そもそもJavaScriptのコーディングの自由度が高い

もともとJavaScriptは自由度が高い言語として設計されている。

## 「本当に不要なところ」の判別が難しい

* 関数宣言の後
* `if`文の後
* `try`-`catch`の後

この判別は多少やっかいで、例えば関数宣言の後にはセミコロンは不要だが関数式の後には必要だ。

# 結論

<b>セミコロンの有無に関係なくJavaScriptのプログラムが動くのは事実なので、どちらかに優位があるというわけではない。</b>しかし、他人と共同作業しているコードであればそのプロジェクトのスタイルに合わせることは言うまでもないだろう。

# 私の意見

**JavaScript同様にTypeScriptもコーディングの自由度が高いので、ESLint等のコーディング規約で統一した方がいい。**

# 参考

https://blog.tai2.net/automatic_semilocon_insertion.html